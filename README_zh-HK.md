# 🏦 AI 驅動股票研究系統

> **用本地 LLM、RAG 同 ReAct 編排，打造專業級多 Agent 股票研究平台**

[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![Ollama](https://img.shields.io/badge/Ollama-qwen2.5:7b-green.svg)](https://ollama.ai/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Status: Production](https://img.shields.io/badge/Status-Production%20Ready-success.svg)]()

[English Version](README.md) | **繁體中文（粵語）**

---

## 📖 系統簡介

呢個系統可以將 SEC 財務報表同市場數據，自動生成專業級股票研究報告。

### 核心功能

- 📄 **RAG 文件分析** - 深入分析 10-K/10-Q 報表，用 ChromaDB 做向量搜尋
- 🌐 **網絡情報** - 實時市場數據同新聞整合
- 🧠 **ReAct 編排** - 迭代式「諗→做→睇」推理循環
- 🎯 **10/10 質素** - 機構級報告，自動驗證引用
- ⚡ **本地優先** - 喺你部機運行 Ollama（唔使俾雲端 API 錢）

### 主要特色

✅ **自動化研究報告** - 執行摘要、投資理據、風險分析、估值  
✅ **100% 引用覆蓋** - 每個聲稱都有來源（10-K 頁碼或網址）  
✅ **時間感知** - 清楚區分歷史數據（10-K）同當前數據（網絡）  
✅ **多 Agent 系統** - 商業分析師（RAG）+ 網絡搜尋 Agent（實時）  
✅ **專業 UI** - Streamlit 界面，實時指標同追蹤可視化  
✅ **質量驗證** - 自動評分同引用缺口檢測  

---

## 🏗️ 系統架構

### 整體流程圖

```
┌─────────────────────────────────────────────────────────────┐
│                     用戶查詢                                  │
│          「Apple 有咩競爭風險？」                             │
└──────────────────┬──────────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────────────┐
│             ReAct 編排器 (v2.1)                              │
│  • 規則式推理（迭代 1-3）                                     │
│  • 專家 Agent 選擇                                           │
│  • 本地 LLM 合成（qwen2.5:7b）                               │
│  • 自動引用驗證                                               │
└──────┬────────────────────────────────────┬─────────────────┘
       │                                    │
       │  迭代 1                             │  迭代 2
       ▼                                    ▼
┌──────────────────────┐           ┌──────────────────────┐
│  商業分析師 Agent     │           │  網絡搜尋 Agent       │
│  ─────────────────   │           │  ──────────────────  │
│  • RAG 分析          │           │  • 實時新聞          │
│  • ChromaDB 搜尋     │           │  • 市場數據          │
│  • BERT 重排序       │           │  • 分析師報告        │
│  • 10-K 引用         │           │  • 網址引用          │
│                      │           │                      │
│  來源: [1-7]         │           │  來源: [8-12]        │
└──────────────────────┘           └──────────────────────┘
       │                                    │
       │  返回帶頁碼引用嘅分析                │  返回帶網址引用嘅數據
       │                                    │
       └──────────┬────────────────────────┘
                  │
                  │  迭代 3: 完成
                  ▼
┌─────────────────────────────────────────────────────────────┐
│                  合成引擎                                     │
│  • 合併文件（1-7）+ 網絡（8-12）來源                          │
│  • 生成專業報告結構                                           │
│  • 強制 100% 引用覆蓋                                         │
│  • 驗證質量（0-100 分）                                       │
└──────────────────┬──────────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────────────┐
│             專業股票研究報告                                  │
│  ───────────────────────────────────────────────────────── │
│  • 執行摘要 [有引用]                                          │
│  • 投資理據 [8+ 引用]                                         │
│  • 業務概覽（歷史 - 10-K）[1-7]                              │
│  • 最新發展（當前 - 網絡）[8-12]                             │
│  • 風險分析（歷史 + 新興）[有引用]                            │
│  • 估值背景 [100% 引用]                                       │
│  • 參考資料（所有來源連網址）                                 │
│  ───────────────────────────────────────────────────────── │
│  質量分數: 85/100 | 引用: 45 | 耗時: 5.1 分鐘                │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔄 ReAct 工作流程詳解

### 三次迭代模式（規則式編排）

#### **迭代 1️⃣：商業分析師（文件分析）**

```python
用戶查詢 → 商業分析師
         ↓
    RAG 流程：
    1. 查詢嵌入（nomic-embed-text）
    2. ChromaDB 向量搜尋（Top 50 塊）
    3. BERT 重排序（Top 10 最相關）
    4. LangGraph 處理（qwen2.5:7b）
    5. 結構化分析 + 頁碼引用
         ↓
    返回：「Apple FY2025 收入 $394B [1]，
           毛利率 43.8% [2]，
           供應鏈風險：67% 製造喺中國 [3]」
```

**商業分析師人設**：
- 📊 財務健康
- ⚠️ 風險因素  
- 🏆 競爭地位
- 💼 商業模式
- 📈 增長策略

---

#### **迭代 2️⃣：網絡搜尋 Agent（補充實時數據）**

```python
用戶查詢 + 商業分析師輸出 → 網絡搜尋 Agent
                          ↓
                    增強查詢：
                    加「2026」、「最新」、「Q1」等時間關鍵字
                          ↓
                    Tavily 搜尋 API（Top 5 結果）
                          ↓
                    qwen2.5:7b 合成（temp=0.0，保留引用）
                          ↓
                    返回：「Q1 2026 收入增長 8.2% YoY [8]，
                           摺疊 iPhone 預計 H2 2026 推出 [11]，
                           市值 $2.4T [9]」
```

**特色**：
- ✅ 時間上下文 - 自動加「2026」、「Q1」、「最近」
- ✅ 引用保留 - 溫度 0.0 確保準確引用
- ✅ 降級注入 - 如果 LLM 失敗，自動注入引用

---

#### **迭代 3️⃣：本地 LLM 合成（10/10 質量）**

```python
所有 Agent 輸出 → 合成引擎
               ↓
          提取來源：
          • 文件來源：[1-7] filename.pdf - Page X
          • 網絡來源：[8-12] Title - URL
               ↓
          qwen2.5:7b 合成：
          • 溫度：0.25（平衡質量 + 速度）
          • Token 限制：3500（全面但快速）
          • 超時：300 秒（5 分鐘最大）
               ↓
          後處理：
          1. 清理 [SOURCE-X] → [X]
          2. 生成格式化參考資料
          3. 質量驗證（自動評分）
               ↓
          返回：機構級研究報告
```

**質量要求（10/10 標準）**：
- 🔥 每個聲稱必須引用
- 🔥 每個數字必須引用
- 🔥 投資理據必須有 8+ 引用
- 🔥 時間標記（FY2025 vs Q1 2026）
- 🔥 引用密度目標：每節最少 3 個引用

---

## 🚀 快速入門

### 前置條件

- **Python 3.11+**
- **Ollama** - 本地 LLM（[下載](https://ollama.ai/)）
- **10-K PDF** - SEC 報表放喺 `data/{股票代號}/` 資料夾

### 1. 安裝

```bash
# Clone 代碼庫
git clone https://github.com/hck717/Agent-skills-POC.git
cd Agent-skills-POC

# 建立虛擬環境
python3.11 -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# 安裝依賴
pip install -r requirements.txt
```

### 2. 設定 Ollama

```bash
# 終端 1：啟動 Ollama 伺服器
ollama serve

# 終端 2：下載所需模型
ollama pull qwen2.5:7b       # 主分析模型（7B 參數）
ollama pull nomic-embed-text  # 向量搜尋嵌入
```

### 3. 加入數據

```bash
# 組織你嘅 10-K 報表
data/
├── AAPL/
│   └── APPL 10-k Filings.pdf
├── TSLA/
│   └── TSLA 10-K 2024.pdf
└── MSFT/
    └── MSFT 10-K 2024.pdf
```

### 4. 啟動

```bash
streamlit run app.py
```

🎉 **喺瀏覽器打開 `http://localhost:8501`**

---

## 🎨 Streamlit UI 功能

### 主控台

- 📊 **實時指標** - 耗時、迭代次數、專家調用、質量分數
- 📝 **報告查看器** - Markdown 渲染，可點擊引用
- 🔍 **ReAct 追蹤** - 完整思考-行動-觀察循環可視化
- 💾 **匯出** - 下載 Markdown 格式報告
- ⚙️ **設定** - 調整最大迭代、溫度、超時

### 範例會話

```
📊 結果
迭代次數: 3
耗時: 303.6秒
專家: 2
平均每次: 101.2秒

🤖 調用專家: business_analyst, web_search_agent

🔍 查詢: Apple 最新競爭發展係咩？

📄 研究報告:
[顯示完整專業報告]

🧠 ReAct 推理追蹤:
[可展開追蹤顯示每次迭代]
```

---

## 📁 代碼庫結構

```
Agent-skills-POC/
│
├── 📄 README.md                    # 英文版
├── 📄 README_zh-HK.md              # 粵語版（呢個檔案）
├── 📄 requirements.txt             # Python 依賴
├── 📄 .gitignore                   # Git 忽略規則
│
├── 🎨 app.py                       # Streamlit UI（主入口）
├── 🧠 orchestrator_react.py        # ReAct 編排器（v2.1）
│
├── 🤖 skills/                      # 專家 Agent
│   ├── business_analyst/
│   │   ├── agent.py               # RAG 驅動 10-K 分析
│   │   ├── graph_agent.py         # LangGraph 實現
│   │   └── SKILL.md               # Agent 說明
│   │
│   └── web_search_agent/
│       ├── agent.py               # 實時網絡情報
│       └── README.md              # Agent 說明
│
├── 📂 data/                        # SEC 報表（你嘅 10-K PDF）
│   ├── AAPL/
│   │   └── APPL 10-k Filings.pdf
│   ├── TSLA/
│   │   └── TSLA 10-K 2024.pdf
│   └── .gitkeep
│
├── 📚 docs/                        # 文檔
│   ├── QUICKSTART.md              # 5 分鐘設定指南
│   ├── CHANGELOG.md               # 版本歷史
│   └── ...
│
└── 💾 storage/                     # 自動生成
    └── chroma_db/                 # 向量數據庫
```

---

## 🎓 技術棧

### 核心技術

| 組件 | 技術 | 用途 |
|-----------|------------|------|
| **LLM** | Ollama (qwen2.5:7b) | 本地推理，零 API 成本 |
| **嵌入** | nomic-embed-text | 向量搜尋 |
| **向量數據庫** | ChromaDB | 文件存儲 |
| **重排序** | sentence-transformers/BERT | 相關性評分 |
| **編排** | 自訂 ReAct | Agent 協調 |
| **UI** | Streamlit | 網頁界面 |
| **PDF 處理** | PyPDF2 | 文件解析 |
| **網絡搜尋** | Tavily API | 實時數據 |

### Python 依賴

```txt
streamlit>=1.28.0       # UI 框架
langchain>=0.1.0        # LLM 編排
chromadb>=0.4.18        # 向量數據庫
sentence-transformers   # BERT 重排序
ollama                  # 本地 LLM 客戶端
pypdf2                  # PDF 處理
requests                # HTTP 客戶端
tavily-python           # 網絡搜尋 API（可選）
```

---

## 📊 性能指標

### 硬件要求

| 組件 | 最低 | 建議 |
|-----------|---------|-------------|
| RAM | 8GB | 16GB+ |
| CPU | 4 核心 | 8+ 核心 |
| 儲存 | 10GB | 20GB+ |
| GPU | 無 | Apple Silicon 或 NVIDIA |

### 速度基準

| 任務 | 耗時 | 備註 |
|------|----------|-------|
| 文件攝取 | 30-60秒 | 每個 10-K 一次性 |
| 商業分析師調用 | 60-90秒 | RAG + LLM 分析 |
| 網絡搜尋 Agent 調用 | 30-45秒 | 搜尋 + 合成 |
| 最終合成 | 120-180秒 | 報告生成 |
| **總查詢時間** | **3-5 分鐘** | 端到端 |

### 質量 vs 速度權衡

| 溫度 | 速度 | 質量 | 用途 |
|-------------|-------|---------|----------|
| 0.15 | 慢 | 95/100 | 監管報告 |
| 0.20 | 中等 | 90/100 | 客戶簡報 |
| **0.25** | **快** | **85/100** | **內部分析** |
| 0.30 | 最快 | 75/100 | 快速摘要 |

---

## 🧪 測試

### 快速系統檢查

```bash
# 驗證 Ollama 連接
ollama list
# 應該顯示: qwen2.5:7b, nomic-embed-text

# 測試編排器
python orchestrator_react.py
# 問: "Apple 嘅主要產品係咩？"

# 啟動 UI
streamlit run app.py
```

### 範例查詢

**簡單（2-3 分鐘）：**
```
「Apple 有咩主要產品同服務？」
```

**中等（3-4 分鐘）：**
```
「根據佢哋最新 10-K 報表，分析 Apple 嘅競爭風險」
```

**複雜（4-5 分鐘）：**
```
「根據 Apple FY2025 10-K：
1. 有咩主要風險因素？
2. 佢哋嘅商業模式點演變？
3. 最新競爭發展係咩？
4. 提供具體頁碼參考同當前市場背景。」
```

---

## 🚧 發展路線

### v2.2（下個版本）
- [ ] 量化分析師（財務比率、DCF 模型）
- [ ] 市場分析師（實時定價、技術指標）
- [ ] 行業分析師（行業比較、同行分析）
- [ ] 增強網絡爬蟲（完整文章內容）
- [ ] 多文件比較

### v3.0（未來）
- [ ] 多輪對話記憶
- [ ] 圖表生成（matplotlib 整合）
- [ ] Excel 匯出連數據表
- [ ] API 端點（REST API）
- [ ] 認證 & 多用戶支援
- [ ] 雲端部署指南（AWS/GCP）

---

## 💡 點解要用呢個系統？

### 優勢

1. **💰 零 API 成本** - 本地 LLM 合成，唔使俾 OpenAI/Claude 錢
2. **🔒 完全私隱** - 數據留喺本地，唔會上傳雲端
3. **📚 文件引用** - 每個聲稱都有 10-K 頁碼參考
4. **🌐 網絡補充** - 用 Tavily 補充當前市場數據（可選）
5. **⚡ 快速迭代** - 3-5 分鐘生成專業報告
6. **🎯 機構質量** - 適合 SEC 審查同專業投資決策

### 適合場景

- 📊 **股票研究** - 內部投資分析
- 📈 **財務盡職調查** - M&A 交易準備
- 🏦 **銀行研究部** - 快速生成初稿
- 🎓 **學術研究** - 財務數據分析
- 💼 **個人投資者** - 深入理解公司基本面

---

## 🤝 貢獻

歡迎貢獻！重點領域：

1. **新專家 Agent** - 行業、ESG、宏觀分析師
2. **數據源** - Bloomberg、Reuters、FactSet 整合
3. **質量改進** - 更好嘅引用提取、事實檢查
4. **性能** - 更快合成、平行 Agent 執行
5. **文檔** - 教學、範例、最佳實踐

---

## 📜 授權

MIT License - 詳見 [LICENSE](LICENSE)

---

## 🙏 鳴謝

- **Ollama** - 本地 LLM 基礎設施
- **LangChain** - Agent 框架
- **ChromaDB** - 向量數據庫
- **Streamlit** - 快速 UI 開發
- **社群** - 開源 AI 項目嘅啟發

---

## 📞 支援

- 📖 **文檔**: [docs/](docs/)
- 🐛 **問題**: [GitHub Issues](https://github.com/hck717/Agent-skills-POC/issues)
- 💬 **討論**: [GitHub Discussions](https://github.com/hck717/Agent-skills-POC/discussions)

---

**用 ❤️ 打造專業股票研究**

⭐ 如果覺得有用，俾個 Star 呢個 repo！

---

## 常見問題（FAQ）

### 1. 點解要用本地 LLM？
唔使俾 API 錢，數據私隱，可以離線運行。

### 2. 需要 GPU 嗎？
唔一定要，但有 Apple Silicon 或 NVIDIA GPU 會快好多。

### 3. 可以分析中文財報嗎？
可以，qwen2.5 模型支援中文，但記得調整 prompt。

### 4. Tavily API 係咪必須？
唔係，冇 Tavily 只會用文件分析，唔會有網絡補充。

### 5. 點樣加新 Agent？
參考 `skills/` 資料夾嘅結構，實現 `analyze()` 方法，然後喺 `app.py` 註冊。

### 6. 報告質量可以調整嗎？
可以，喺 `orchestrator_react.py` 調整溫度同 prompt。

### 7. 支援咩文件格式？
目前支援 PDF、DOCX、TXT、MD。

### 8. 可以同時分析多間公司嗎？
可以，喺 `data/` 加多個股票代號資料夾就得。