FROM apache/airflow:2.8.1-python3.11

# Install system dependencies
USER root
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Install Python dependencies at build time (not runtime)
USER airflow
RUN pip install --no-cache-dir \
    psycopg2-binary==2.9.9 \
    neo4j==6.1.0 \
    qdrant-client==1.16.2 \
    requests==2.31.0 \
    pandas==2.1.4 \
    duckdb==1.0.0 \
    feedparser==6.0.11 \
    openai==1.12.0 \
    scipy==1.11.4

# Upgrade pip
RUN python -m pip install --upgrade pip
